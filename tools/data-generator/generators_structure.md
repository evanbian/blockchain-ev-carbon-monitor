# 新能源车辆碳减排计量系统 - 数据模拟器设计

## 1. 架构概述

数据模拟器采用模块化设计，包含以下核心组件：

```
tools/data-generator/
├── index.js                # 主入口
├── config.js               # 配置文件
├── server.js               # 控制面板服务器
├── utils/                  # 工具函数
│   ├── randomUtils.js      # 随机数生成工具
│   ├── dateUtils.js        # 日期处理工具
│   └── fileUtils.js        # 文件操作工具
├── generators/             # 各类数据生成器
│   ├── vehicleGenerator.js # 车辆基础数据生成器
│   ├── drivingGenerator.js # 行驶数据生成器 
│   ├── carbonGenerator.js  # 碳减排数据生成器
│   └── blockchainGenerator.js # 区块链数据生成器
├── models/                 # 数据模型定义
│   ├── vehicleModel.js     # 车辆数据模型
│   ├── drivingModel.js     # 行驶数据模型
│   ├── carbonModel.js      # 碳减排数据模型
│   └── blockchainModel.js  # 区块链数据模型
├── integrations/           # 系统集成接口
│   ├── databaseConnector.js # 数据库连接器
│   ├── apiConnector.js     # API连接器
│   └── blockchainConnector.js # 区块链连接器
├── ui/                     # 控制面板界面
│   ├── index.html          # 主页面
│   ├── app.js              # 应用逻辑
│   └── styles.css          # 界面样式
└── output/                 # 输出目录
    ├── vehicles.json       # 车辆数据
    ├── driving-data.json   # 行驶数据
    ├── carbon-data.json    # 碳减排数据
    └── blockchain-data.json # 区块链数据
```

## 2. 主要功能模块

### 2.1 车辆基础数据生成器 (vehicleGenerator.js)
- 生成车辆基本信息（VIN码、车型、车牌、制造商等）
- 支持批量生成多辆车数据
- 可配置车型分布、生产年份范围等参数

### 2.2 行驶数据生成器 (drivingGenerator.js)
- 生成车辆行驶轨迹（位置、速度、里程等）
- 生成车辆能耗数据
- 支持真实行驶模式模拟（如上下班通勤模式、周末出行模式）
- 支持批量生成和实时流式生成

### 2.3 碳减排数据生成器 (carbonGenerator.js)
- 基于行驶和能耗数据计算碳减排量
- 应用国标方法学计算积分
- 生成完整的碳减排和积分记录

### 2.4 区块链数据生成器 (blockchainGenerator.js)
- 生成模拟区块数据
- 生成交易数据，包括车辆注册、数据上链、碳积分生成等交易类型
- 生成智能合约调用记录

### 2.5 控制面板 (server.js, ui/)
- 提供Web界面配置模拟参数
- 实时监控数据生成状态
- 支持启动/停止/暂停生成过程
- 查看生成数据统计和预览

## 3. 数据生成模式

### 3.1 批量生成模式
- 一次性生成指定数量和时间范围的历史数据
- 支持参数化配置和随机变化
- 输出到文件或直接插入数据库

### 3.2 实时生成模式
- 按照接近真实时间的速率生成数据
- 支持异常情况注入和场景模拟
- 通过API实时推送到系统

## 4. 与系统集成

### 4.1 数据库集成
- 直接将生成的数据写入系统数据库
- 支持PostgreSQL数据库格式

### 4.2 API集成
- 通过系统API接口提交数据
- 模拟真实客户端请求

### 4.3 区块链集成
- 与测试区块链网络交互
- 提交交易到测试网络

## 5. 配置参数

主要配置参数包括：

### 5.1 全局配置
- 数据量级：车辆数量、时间跨度
- 随机种子：控制随机性，实现可重复的测试数据
- 输出模式：文件、数据库、API

### 5.2 车辆配置
- 车型分布：不同车型的比例
- 地理区域：车辆分布区域
- 状态分布：在线/离线/异常状态的比例

### 5.3 行驶数据配置
- 行驶模式：通勤、长途、市区等模式的比例
- 异常率：数据异常的概率
- 季节影响：不同季节对能耗的影响

### 5.4 区块链配置
- 区块生成速率
- 交易类型分布
- 燃料费用范围
