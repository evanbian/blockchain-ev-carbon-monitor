# 后端开发进度跟踪

## 已完成任务

### 基础架构
- [x] 搭建后端项目结构
- [x] Web3j配置
- [x] 基础API层实现

### 功能实现
- [x] 实现数据库访问层
- [x] 实现业务逻辑层
- [x] 实现API接口层
- [x] 实现认证和权限控制
- [x] 车辆管理功能
  - [x] 车辆数据模型定义
  - [x] 车辆控制器(Controller)
  - [x] 车辆服务(Service)
  - [x] 车辆数据库访问(Repository)
- [x] 数据分析服务
  - [x] 碳减排总量接口 (`/summary`)
  - [x] 碳减排趋势接口 (`/trends`)
  - [x] 车型碳减排对比接口 (`/by-model`)
  - [x] 车辆行驶数据接口 (`/driving/{vin}`)
  - [x] 碳减排预测接口 (`/predictions/{vin}`) (基于历史平均值)
  - [x] 地理空间热力图数据接口 (`/heatmap`)
- [x] 为 `CarbonEmission` 实体添加经纬度字段 (`latitude`, `longitude`)
- [x] 实现数据分析接口的经济价值计算逻辑
- [x] 完善数据分析接口的异常处理 (引入 `ResourceNotFoundException` 和全局处理器)

### 系统优化
- [x] 优化数据分析服务的数据库查询性能 (解决N+1问题)

## 待完成任务

### 区块链集成
- [ ] 实现区块链交互服务
- [ ] 智能合约交互封装
- [ ] 区块链数据同步服务
- [ ] 交易监听服务

### 功能实现
- [ ] 碳减排计算服务
  - [ ] 基于国标方法学的计算实现
  - [ ] 历史数据聚合分析
- [ ] 碳积分管理服务
- [x] 异常监控服务
  - [x] 告警数据模型定义 (Alert 实体)
  - [x] 告警控制器(Controller) (增删改查基础接口)
  - [x] 告警服务(Service) (查询、更新状态)
  - [x] 告警数据库访问(Repository)
  - [x] 实现基于条件的告警查询 (Specification)
  - [x] 修复告警查询中枚举类型处理错误 (Service 层)
  - [x] 修复告警查询中枚举参数绑定错误 (Controller 层)
  - [x] 统一 Controller 路径 (`/api/v1/...`)
  - [ ] 实时告警逻辑 (待实现)
  - [ ] 告警规则配置 (待实现)
- [ ] 数据分析服务 - 进一步优化
  - [ ] 实现更复杂的预测模型 (如 ARIMA)
  - [ ] 实现按周分组的趋势分析
  - [ ] 实现热力图数据的后端聚合 (如果前端需要)

### 数据处理
- [ ] 索引优化 (进一步检查数据库索引)
- [ ] 数据迁移脚本编写 (特别是为新加的经纬度列)
- [ ] 批量数据处理优化

### 系统优化
- [ ] 缓存实现
- [ ] 安全加固 (进一步检查和加固)

## 下一步计划
1. **(优先级高)** 实现区块链交互服务，与智能合约集成。
2. **(优先级高)** 开发碳减排计算服务（需要明确国标方法学细节）。
3. **(优先级高)** 开发碳积分管理服务。
4. **(中优先级)** 实现异常监控服务的实时告警逻辑和规则配置。
5. **(低优先级)** 考虑实现数据分析服务的进一步优化项。

## 依赖事项
- 需要智能合约ABI和部署地址。
- 需要确认前端API接口需求详情 (大部分已通过本次同步明确)。
- 需要建立Web3节点连接配置。
- 需要完成数据库 `carbon_emissions` 表的结构变更 (添加 `latitude`, `longitude` 列)。
- 需要确认碳减排计算服务的具体算法和规则。
- 需要确认碳积分生成的具体规则。
